<% if File.exist?("content" + photo(@item)) %>
  <img id="author-photo" src="<%= photo(@item) %>" alt="<%= @item[:title] %>"/>
<% end %>

<div id="author-info">
  <div id="name"><a href="<%= @item[:link] %>"><%= @item[:title] %></a></div>
  <div id="email"><%= obfuscate_email(@item[:email]) %></div>

  <div id="studies">
    <div id="subject"><%= @item[:subject] %></div>
    <div id="university"><%= @item[:university] %></div>
    <div id="country"><%= @item[:country] %><%= ', ' + @item[:period] if @item[:period] %></div>
  </div>
</div>

<div id="feed">
  <%
    if @item[:feed]
      feed = FeedNormalizer::FeedNormalizer.parse open(@item[:feed])
  %>
    <% for i in 0..2
        break if ! post = feed.entries[i]
      
        how_new = ['(най-ново)', '(почти ново)', '(просто ново)']
    %>
      <div id="feed-container">
        <div id="feed-title">
          <a href="<%= post.url %>"><%= post.title %></a>
          <div id="feed-subtitle"><%= how_new[i] %></div>
        </div>

        <div id="feed-content"><%=
            maxlen = 220
            brief = Sanitize.clean(post.content[0..2*maxlen])
            brief = brief[0..maxlen]   # crop not more than 300 chars
            brief.split(' ')[0..-2].join(' ')
          %>
          <a href="<%= post.url %>"> [...]</a>
        </div>
      </div>
    <% end %>

    <% if feed.entries[3..-1] %>
      <div id="feed-older-subtitle">И малко по-стари: </div>
      <% feed.entries[3..-1].each_with_index { |post, i| %>
        <a href="<%= post.url %>"><%= post.title %></a><%= (i<feed.entries.size-4 ? ', ' : '') %><% } %>
    <% end %>
  <% end %>
</div>
